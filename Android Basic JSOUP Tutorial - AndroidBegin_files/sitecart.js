(function(undefined){var tag=document.getElementById('bsasitecart');if(!tag||window.bsap_sitecart)return;var bsahost='buysellads.com';var cdnhost='cdn.buysellads.com';var dossl=true;var storagekey='_bsacart-localstore';var siteid=tag.getAttribute('data-site');var inventorycontainer=tag.getAttribute('data-inventory-id');var forceloadinventory=tag.hasAttribute('data-load-inventory');var preview=tag.hasAttribute('data-preview');var cartid=false;var elements={};var inventory={loadcallback:null,loaded:false,zones:[]};function dropCartHTML(){if(document.register)document.register("x-bsa-site-cart");elements.plugin=document.createElement("x-bsa-site-cart");var html='<a id="_bsacart-tabclose" href="#">x</a><span class="_bsacart-tab" id="_bsacart-tab"><em class="_bsacart-text">Your Cart</em><em id="_bsacart-amount">0</em></span><span class="_bsacart-cart" id="_bsacart-cart"><span class="_bsacart-cartempty"><span class="_bsacart-emptymsg">Your cart is currently empty.</span></span><ul id="_bsacart-items"></ul><em class="_bsacart-total" id="_bsacart-total">Order total: <strong id="_bsacart-totalcost">$0.00</strong></em><a href="#" class="_bsacart-button _bsacart-go" id="_bsacart-checkout">Edit Items and Checkout</a></span><span class="_bsacart-modalmask" id="_bsacart-modalmask"></span><span class="_bsacart-modal" id="_bsacart-modal"><span class="_bsacart-modalwrap" id="_bsacart-modalcontent"><span class="_bsacart-modalheader"><span id="_bsacart-modaltitle"> </span><span id="_bsacart-modalwhat">?</span><span id="_bsacart-modalclose">Close</span></span></span></span>';elements.plugin.innerHTML="<style>x-bsa-site-cart{display:none}</style>"+html;var css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("href","//cdn.buysellads.com/ac/sitecart.css");tag.parentNode.insertBefore(css,tag);css=document.createElement("link");css.setAttribute("rel","stylesheet");css.setAttribute("href","//s3.buysellads.com/sitecart/"+siteid+".css");tag.parentNode.insertBefore(css,tag);document.body.appendChild(elements.plugin);elements.receiver=document.createElement("iframe");elements.receiver.setAttribute("src",(dossl?"https://":"http://")+bsahost+"/sitecart/receive");elements.receiver.className="_bsacart-receiver";elements.plugin.appendChild(elements.receiver);addClass(elements.plugin,"_bsacart-loaded");if(!preview){var gif=document.createElement("img");gif.setAttribute("src",(dossl?"https://":"http://")+"buysellads.com/sitecart/gif/site/"+siteid)}elements.tab=document.getElementById('_bsacart-tab');elements.tabcount=document.getElementById('_bsacart-amount');elements.cart=document.getElementById('_bsacart-cart');elements.cartempty=document.getElementById('_bsacart-cartempty');elements.items=document.getElementById('_bsacart-items');elements.totalcost=document.getElementById('_bsacart-totalcost');elements.checkout=document.getElementById('_bsacart-checkout');elements.modal=document.getElementById('_bsacart-modal');elements.modalmask=document.getElementById('_bsacart-modalmask');elements.modalclose=document.getElementById('_bsacart-modalclose');elements.help=document.getElementById('_bsacart-modalwhat');elements.tabclose=document.getElementById('_bsacart-tabclose');elements.modalcontent=document.getElementById('_bsacart-modalcontent');elements.modaltitle=document.getElementById('_bsacart-modaltitle')}function loadCart(){var cart;if(!window.localStorage||!window.localStorage[storagekey]){cart=false}else{cart=JSON.parse(window.localStorage[storagekey])}if(!cart){cartid=false;renderCartItems([])}else{var cart=JSON.parse(window.localStorage[storagekey]);cartid=cart.id;renderCartItems(cart.items)}}function createCartItem(data){var title=data.title;var rate="$"+data.rate+" "+data.unit;var qty=data.qty;var ad=data.ad;var zone=data.zone;var item=document.createElement("li");item.className="_bsacart-cf";if(ad!==undefined){var span=document.createElement("span");span.className="_bsacart-removeicn";span.innerHTML="&times;";on(span,"click",function(){sendMessage({remove:{site:siteid,cart:cartid,ad:ad}})});item.appendChild(span)}var em=document.createElement("em");em.className="_bsacart-ztitle";em.appendChild(document.createTextNode(title));item.appendChild(em);if(rate!==undefined){var em=document.createElement("em");em.className="_bsacart-zrate";em.appendChild(document.createTextNode(rate));item.appendChild(em)}if(qty!==undefined){var em=document.createElement("em");em.className="_bsacart-zqty";em.appendChild(document.createTextNode(qty));item.appendChild(em)}return item}function renderCartItems(items){while(elements.items.childNodes.length>0)elements.items.removeChild(elements.items.firstChild);var total=0;if(items.length==0){addClass(elements.plugin,"_bsacart-noitems");removeClass(elements.plugin,"_bsacart-hasitems")}else{for(var i=0;i<items.length;i++){elements.items.appendChild(createCartItem(items[i]));total+=items[i].price}addClass(elements.plugin,"_bsacart-hasitems");removeClass(elements.plugin,"_bsacart-noitems")}elements.tabcount.firstChild.nodeValue=items.length;elements.totalcost.firstChild.nodeValue="$"+total.toFixed(2)}function createSoldOutItem(title){var item=document.createElement("li");item.className="_bsacart-cf _bsacart-soldout";var span=document.createElement("span");span.className="_bsacart-removeicn";span.innerHTML="&times;";on(span,"click",loadCart);item.appendChild(span);var em=document.createElement("em");em.className="_bsacart-ztitle";em.appendChild(document.createTextNode(title));item.appendChild(em);var em=document.createElement("em");em.className="_bsacart-zmessage";em.appendChild(document.createTextNode("Sorry, this zone has sold out."));item.appendChild(em);return item}function appendSoldOutItem(title){elements.items.appendChild(createSoldOutItem(title));addClass(elements.plugin,"_bsacart-hasitems");removeClass(elements.plugin,"_bsacart-noitems")}function loadInventoryData(data){if(inventorycontainer&&document.getElementById(inventorycontainer)){document.getElementById(inventorycontainer).innerHTML=data.html;initLaunchers("#"+inventorycontainer)}inventory.zones=data.zones;inventory.loaded=true;callInventoryLoadCallback()}function registerLoadInventoryCallback(f){inventory.loadcallback=f;callInventoryLoadCallback()}function callInventoryLoadCallback(){if(inventory.loadcallback&&inventory.loaded)inventory.loadcallback(inventory.zones)}function addToCart(zone){var o={site:siteid,zone:zone};if(cartid)o.cart=cartid;sendMessage({add:o})}function loadView(which){var urlparams='/site/'+siteid+(cartid?'/cart/'+cartid:'')+(preview?'/preview/1':'');loadModalContent((dossl?'https://':'http://')+bsahost+'/sitecart/'+which+urlparams);showModal()}function loadCheckout(){loadView('items')}function loadHelp(){loadView('help')}function openCart(){removeClass(elements.plugin,'_bsacart-tabdismissed');addClass(elements.cart,'_bsacart-cart-enter')}function toggleCart(){toggleClass(elements.cart,'_bsacart-cart-enter')}function toggleModal(){toggleClass(elements.modalmask,'_bsacart-on');toggleClass(elements.modal,'_bsacart-on')}function closeCart(){removeClass(elements.cart,'_bsacart-cart-enter')}function closeModal(){removeClass(elements.modalmask,'_bsacart-on');removeClass(elements.modal,'_bsacart-on');setModalTitle(" ")}function closeTab(){addClass(elements.plugin,'_bsacart-tabdismissed')}function showModal(){removeClass(elements.plugin,'_bsacart-tabdismissed');addClass(elements.modalmask,'_bsacart-on');addClass(elements.modal,'_bsacart-on')}function loadModalContent(src){var existing=document.getElementById('_bsacart-modalframe');if(existing){existing.parentNode.removeChild(existing)}var frame=document.createElement('iframe');frame.id='_bsacart-modalframe';frame.width='100%';frame.height='100%';frame.frameBorder='0';frame.src=src;document.getElementById('_bsacart-modalcontent').appendChild(frame)}function setModalTitle(title){elements.modaltitle.firstChild.nodeValue=title}function hasClass(el,name){return new RegExp('(\\s|^)'+name+'(\\s|$)').test(el.className)}function addClass(el,name){if(!hasClass(el,name)){el.className+=(el.className?' ':'')+name}}function toggleClass(elem,className){var newClass=' '+elem.className.replace(/[\t\r\n]/g,' ')+' ';if(hasClass(elem,className)){while(newClass.indexOf(' '+className+' ')>=0){newClass=newClass.replace(' '+className+' ',' ')}elem.className=newClass.replace(/^\s+|\s+$/g,'')}else{elem.className+=' '+className}}function removeClass(el,name){if(hasClass(el,name)){el.className=el.className.replace(new RegExp('(\\s|^)'+name+'(\\s|$)'),' ').replace(/^\s+|\s+$/g,'')}}var receivers={cart:function(cart){if(cart){window.localStorage[storagekey]=JSON.stringify(cart);openCart()}else{window.localStorage.removeItem(storagekey)}loadCart()},title:function(title){setModalTitle(title)},showcart:function(){openCart()},soldoutzone:function(title){appendSoldOutItem(title)}};function receiveMessage(e){if(e.origin==(dossl?"https://":"http://")+bsahost&&JSON.parse(e.data)){var data=JSON.parse(e.data);if(receivers.hasOwnProperty(data.func)){receivers[data.func](data.arg)}}}function sendMessage(data){data=JSON.stringify(data);elements.receiver.contentWindow.postMessage(data,(dossl?"https://":"http://")+bsahost)}function on(el,event,func){if(el.addEventListener)el.addEventListener(event,func,false);else if(el.attachEvent)el.attachEvent("on"+event,function(e){e.preventDefault=function(){e.returnValue=false};func(e)})}function initLaunchers(container){container=container||"body";var addcart=document.querySelectorAll(container+" .bsa-add-to-cart");for(var i=0;i<addcart.length;i++){var zone=addcart[i].getAttribute("data-bsa-zone").toString();if(zone.length==32)on(addcart[i],"click",(function(z){return function(e){e.preventDefault();addToCart(z)}}(zone)))}}function init(){dropCartHTML();on(elements.checkout,'click',function(e){e.preventDefault();loadCheckout()});on(elements.tabclose,'click',function(e){e.preventDefault();closeTab()});on(elements.tab,'click',toggleCart);on(elements.modalclose,'click',closeModal);on(elements.help,'click',loadHelp);on(window,'message',receiveMessage);loadCart();if(hasClass(elements.plugin,"_bsacart-noitems"))addClass(elements.plugin,"_bsacart-tabdismissed");initLaunchers();if((inventorycontainer&&document.getElementById(inventorycontainer))||forceloadinventory){var script=document.createElement("script");script.src=(dossl?"https://":"http://")+"cdn.buysellads.com/sitecart/"+siteid+".js";document.body.appendChild(script)}}window.bsap_sitecart={loadinventory:loadInventoryData,onloadinventory:registerLoadInventoryCallback,addToCart:addToCart};if(document.addEventListener)on(document,"DOMContentLoaded",init);else on(window,"load",init)})();